!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self).Nestled={})}(this,(function(t){"use strict";const s=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30];class e{constructor(){this.enabled=!1,this.lengthCounter=0,this.lengthCounterHalt=!1}reset(){this.enabled=!1,this.length=0}get enabled(){return this._enabled}set enabled(t){t||(this.lengthCounter=0),this._enabled=t}get length(){return this.lengthCounter}set length(t){this.enabled&&(this.lengthCounter=s[(248&t)>>>3])}updateLength(){this.lengthCounter>0&&!this.lengthCounterHalt&&this.lengthCounter--}}const i=[[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,1,1],[0,0,0,0,1,1,1,1],[1,1,1,1,1,1,0,0]];class h extends e{constructor(t){super(),this.id=t,this.constantVolume=0,this.envelopeEnabled=!0,this.envelopeReset=!1,this.envelopeCycle=0,this.envelopePeriod=0,this.envelopeVolume=0,this.envelopeLoop=!1,this.dutyCycle=0,this.duty=0,this.sweepEnabled=!1,this.sweepReset=!1,this.sweepCycle=0,this.sweepPeriod=0,this.sweepNegate=!1,this.sweepShift=0,this.timerCycle=0,this.timerPeriod=0}reset(){super.reset(),this.envelopeCycle=0,this.envelopeVolume=0,this.sweepCycle=0,this.timerCycle=0,this.volume=0,this.sweep=0,this.timer=0}get volume(){return(this.envelopeEnabled?this.envelopeVolume:this.constantVolume)*this.duty[this.dutyCycle]}set volume(t){this.duty=i[(192&t)>>>6],t>15?(this.lengthCounterHalt=0!=(32&t),this.envelopeEnabled=0==(16&t),this.constantVolume=15&t):(this.lengthCounterHalt=!1,this.envelopeEnabled=!0,this.constantVolume=t),this.envelopePeriod=this.constantVolume,this.envelopeLoop=this.lengthCounterHalt}get sweep(){let t=this.timerPeriod>>>this.sweepShift;return this.sweepNegate?1===this.id?~t:-t:t}set sweep(t){this.sweepEnabled=0!=(128&t),this.sweepPeriod=(112&t)>>>4,this.sweepNegate=0!=(8&t),this.sweepShift=7&t,this.sweepReset=!0}get timer(){return this.timerPeriod}set timer(t){this.timerPeriod=(1792&this.timerPeriod)+t}get length(){return super.length}set length(t){this.dutyCycle=0,this.envelopeReset=!0,this.timerPeriod=255&this.timerPeriod|(7&t)<<8,super.length=t}writeRegister(t,s){switch(t){case 16384:case 16388:this.volume=s;break;case 16385:case 16389:this.sweep=s;break;case 16386:case 16390:this.timer=s;break;case 16387:case 16391:this.length=s}}doCycle(){--this.timerCycle<=0&&(this.timerCycle=this.timerPeriod+1,this.dutyCycle++,this.dutyCycle>=8&&(this.dutyCycle-=8))}doQuarter(){this.envelopeReset?(this.envelopeCycle=this.envelopePeriod,this.envelopeVolume=15,this.envelopeReset=!1):this.envelopeCycle>0?this.envelopeCycle--:(this.envelopeCycle=this.envelopePeriod,this.envelopeVolume>0?this.envelopeVolume--:this.envelopeLoop&&(this.envelopeVolume=15))}doHalf(){if(this.sweepCycle>0)this.sweepCycle--;else{if(this.sweepEnabled&&this.sweepShift){let t=this.timer;t>=8&&t+this.sweep<2048&&(this.timerPeriod+=this.sweep)}this.sweepCycle=this.sweepPeriod}this.sweepReset&&(this.sweepCycle=this.sweepPeriod,this.sweepReset=!1),this.updateLength()}get output(){return this.length>0&&this.timer>=8&&this.timer+this.sweep<2048?this.volume:0}}const r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];class n extends e{constructor(){super(),this.dutyCycle=0,this.linearCounter=0,this.linearCounterMax=0,this.linearCounterReset=!1,this.timerCycle=0,this.timerPeriod=0}reset(){super.reset(),this.dutyPosition=0,this.linearCounter=0,this.timerCycle=0,this.counter=0,this.timer=0}set counter(t){t>=128?(this.lengthCounterHalt=!0,this.linearCounterMax=t-128):(this.lengthCounterHalt=!1,this.linearCounterMax=t),this.linearCounterControl=this.lengthCounterHalt}get timer(){return this.timerPeriod}set timer(t){this.timerPeriod=(1792&this.timerPeriod)+t}get length(){return super.length}set length(t){this.linearCounterReset=!0,this.timerPeriod=255&this.timerPeriod|(7&t)<<8,super.length=t}writeRegister(t,s){switch(t){case 16392:this.counter=s;break;case 16394:this.timer=s;break;case 16395:this.length=s}}doCycle(){this.timerCycle-=2,this.timerCycle<=0&&(this.timerCycle=this.timerPeriod+1,this.lengthCounter&&this.linearCounter&&this.timerPeriod>3&&(this.dutyCycle++,this.dutyCycle>=32&&(this.dutyCycle-=32)))}doQuarter(){this.linearCounterReset?this.linearCounter=this.linearCounterMax:this.linearCounter>0&&this.linearCounter--,this.linearCounterControl||(this.linearCounterReset=!1)}doHalf(){this.updateLength()}get output(){return r[this.dutyCycle]}}const a=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];class o extends e{constructor(){super(),this.constantVolume=0,this.envelopeEnabled=!0,this.envelopeReset=!1,this.envelopeCycle=0,this.envelopePeriod=0,this.envelopeVolume=0,this.envelopeLoop=!1,this.timerMode=!1,this.timerCycle=0,this.timerPeriod=0,this.shiftRegister=1}reset(){super.reset(),this.envelopeCycle=0,this.envelopeVolume=0,this.timerCycle=0,this.shiftRegister=1,this.volume=0,this.timer=0}get volume(){return this.envelopeEnabled?this.envelopeVolume:this.constantVolume}set volume(t){t>15?(this.lengthCounterHalt=0!=(32&t),this.envelopeEnabled=0==(16&t),this.constantVolume=15&t):(this.lengthCounterHalt=!1,this.envelopeEnabled=!0,this.constantVolume=t),this.envelopeLoop=this.lengthCounterHalt,this.envelopePeriod=this.constantVolume}get timer(){return this.timerPeriod}set timer(t){t>15?(this.timerMode=t>=128,this.timerPeriod=a[15&t]):(this.timerMode=!1,this.timerPeriod=a[t])}get length(){return super.length}set length(t){this.envelopeReset=!0,super.length=t}writeRegister(t,s){switch(t){case 16396:this.volume=s;break;case 16398:this.timer=s;break;case 16399:this.length=s}}doCycle(){if(--this.timerCycle<=0){this.timerCycle=this.timerPeriod;let t=1&this.shiftRegister;this.timerMode?t^=this.shiftRegister>>>6&1:t^=this.shiftRegister>>>1&1,this.shiftRegister=this.shiftRegister>>>1|t<<14}}doQuarter(){this.envelopeReset?(this.envelopeCycle=this.envelopePeriod,this.envelopeVolume=15,this.envelopeReset=!1):this.envelopeCycle>0?this.envelopeCycle--:(this.envelopeCycle=this.envelopePeriod,this.envelopeVolume>0?this.envelopeVolume--:this.envelopeLoop&&(this.envelopeVolume=15))}doHalf(){this.updateLength()}get output(){return this.length>0&&!(1&this.shiftRegister)?this.volume:0}}const l=[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54];class d{constructor(t){this.cpu=t,this.enabled=!1,this.cycle=0,this.output=0,this.timerCycle=0,this.timerPeriod=0,this.sampleAddress=0,this.sampleLength=0,this.sampleIndex=0,this.sampleLeft=0,this.sampleLoop=!1,this.sampleBuffer=-1,this.shiftRegister=-1,this.shiftRegisterBits=0,this.irqEnabled=!1,this.irq=!1}reset(){this.cycle=0,this.timerCycle=0,this.sampleBuffer=-1,this.shiftRegister=-1,this.shiftRegisterBits=0,this.rate=0,this.load=0,this.address=0,this.length=0}get enabled(){return this._enabled}set enabled(t){t?0===this.sampleLeft&&(this.sampleIndex=0,this.sampleLeft=this.sampleLength):this.sampleLeft=0,this.irq=!1,this._enabled=t}doIRQ(){this.irq=!0,this.irqEnabled&&this.cpu.doIRQ()}get rate(){return this.timerPeriod}set rate(t){t>=64?(this.irqEnabled=0!=(128&t),this.sampleLoop=0!=(64&t),this.timerPeriod=l[15&t]):(this.irqEnabled=!1,this.sampleLoop=!1,this.timerPeriod=t>15?l[15&t]:l[t]),this.irqEnabled||(this.irq=!1)}get load(){return this.output}set load(t){t>=128&&(t-=128),this.output=t}get address(){return this.sampleAddress}set address(t){this.sampleAddress=49152+64*t}get length(){return this.sampleLength}set length(t){this.sampleLength=16*t+1}writeRegister(t,s){switch(t){case 16400:this.rate=s;break;case 16401:this.load=s;break;case 16402:this.address=s;break;case 16403:this.length=s}}doCycle(){this.cycle>0&&this.cycle--,--this.timerCycle<=0&&(this.timerCycle=this.timerPeriod,this.updateSampleBuffer(),this.updateShiftRegister(),this.updateOutput())}updateSampleBuffer(){this.sampleBuffer<0&&this.sampleLeft>0&&(this.sampleBuffer=this.cpu.read(this.sampleAddress+this.sampleIndex++),this.cycle=4,--this.sampleLeft<=0&&(this.sampleLoop?(this.sampleIndex=0,this.sampleLeft=this.sampleLength):this.irqEnabled&&this.doIRQ()))}updateShiftRegister(){--this.shiftRegisterBits<=0&&(this.shiftRegisterBits=8,this.shiftRegister=this.sampleBuffer,this.sampleBuffer=-1)}updateOutput(){this.shiftRegister>=0&&(1&this.shiftRegister?this.output<=125&&(this.output+=2):this.output>=2&&(this.output-=2),this.shiftRegister>>>=1)}}class u{constructor(t){this.bus=t.bus,this.cpu=t,this.pulse1=new h(1),this.pulse2=new h(2),this.triangle=new n,this.noise=new o,this.dmc=new d(t),this.cyclesPerSample=0,this.cyclesUntilSample=1/0,this.irqDisabled=!1,this.irq=!1,this.status=null,this.counter=null,this.toggle=!1,this.cycle=0}powerOn(){this.bus.audioOutput.start(),this.cyclesPerSample=893415/this.bus.audioOutput.sampleRate,this.cyclesUntilSample=this.cyclesPerSample*this.bus.audioOutput.speedAdjustment}powerOff(){this.bus.audioOutput.stop()}reset(){this.pulse1.reset(),this.pulse2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.counter=0,this.irq=!1}doIRQ(){this.irq=!0,this.cpu.doIRQ()}get status(){let t=(this.pulse1.length&&1)+(this.pulse2.length&&2)+(this.triangle.length&&4)+(this.noise.length&&8)+(this.dmc.sampleLeft&&16)+(this.dmc.irq&&128)+(this.irq&&64);return this.dmc.irq=!1,this.irq=!1,t}set status(t){null!==t?(this.pulse1.enabled=!!(1&t),this.pulse2.enabled=!!(2&t),this.triangle.enabled=!!(4&t),this.noise.enabled=!!(8&t),this.dmc.enabled=!!(16&t)):(this.pulse1.enabled=!1,this.pulse2.enabled=!1,this.triangle.enabled=!1,this.noise.enabled=!1,this.dmc.enabled=!1)}set counter(t){null!==t?(t>=128?(this.counterMode=1,this.irqDisabled=t>=192):(this.counterMode=0,this.irqDisabled=t>=64),this.irqDisabled&&(this.irq=!1),this.resetDelay=this.toggle?3:4,1===this.counterMode&&(this.doQuarter(),this.doHalf())):(this.counterMode=0,this.irqDisabled=!1,this.resetDelay=0)}readRegister(t){return 16405===t?this.status:0}writeRegister(t,s){t<=16387?this.pulse1.writeRegister(t,s):t<=16391?this.pulse2.writeRegister(t,s):t<=16395?this.triangle.writeRegister(t,s):t<=16399?this.noise.writeRegister(t,s):t<=16403?this.dmc.writeRegister(t,s):16405===t?this.status=s:16407===t&&(this.counter=s)}doCycles(t){for(;t--;)(this.toggle=!this.toggle)&&(this.resetDelay>0&&0==--this.resetDelay&&(this.cycle=0),this.doCycle())}doCycle(){let t=this.cycle++;t<=7457?7457===t&&this.doQuarter():t<=14914?14914===t&&(this.doQuarter(),this.doHalf()):t<=22371?22371===t&&this.doQuarter():t>=29828&&(29828===t&&0===this.counterMode?(this.doQuarter(),this.doHalf(),this.irqDisabled||this.doIRQ(),this.cycle=0):37281===t&&(this.doQuarter(),this.doHalf(),this.cycle=0)),this.pulse1.doCycle(),this.pulse2.doCycle(),this.triangle.doCycle(),this.noise.doCycle(),this.dmc.doCycle(),--this.cyclesUntilSample<=0&&(this.doSample(),this.cyclesUntilSample+=this.cyclesPerSample*this.bus.audioOutput.speedAdjustment)}doQuarter(){this.pulse1.doQuarter(),this.pulse2.doQuarter(),this.triangle.doQuarter(),this.noise.doQuarter()}doHalf(){this.pulse1.doHalf(),this.pulse2.doHalf(),this.triangle.doHalf(),this.noise.doHalf()}doSample(){let t=this.pulse1.output+this.pulse2.output,s=3*this.triangle.output+2*this.noise.output+this.dmc.output;this.bus.audioOutput.writeSample(c[t]+p[s])}}const c=new Float32Array(31);for(let t=0;t<31;t++)c[t]=95.52/(8128/t+100);const p=new Float32Array(203);for(let t=0;t<203;t++)p[t]=163.67/(24329/t+100);const m=[7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7];function f(t){return t>255?t-256:t}class R{constructor(t){this.bus=t,this.cycle=-1,this.cycleOffset=-1,this.apu=new u(this),this.ram=new Uint8Array(2048),this.stack=this.ram.subarray(256,512),this.nmiVector=()=>0,this.resetVector=()=>0,this.irqVector=()=>0,this.A=255,this.X=255,this.Y=255,this.P=255,this.SP=255,this.PC=65535,this.addressLookup=[this.imp,this.indX,this.imp,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroX,this.zeroX,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absX,this.absX,this.abs,this.indX,this.imp,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroX,this.zeroX,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absX,this.absX,this.imp,this.indX,this.imp,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroX,this.zeroX,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absX,this.absX,this.imp,this.indX,this.imp,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.ind,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroX,this.zeroX,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absX,this.absX,this.imm,this.indX,this.imm,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroY,this.zeroY,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absY,this.absY,this.imm,this.indX,this.imm,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroY,this.zeroY,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absY,this.absY,this.imm,this.indX,this.imm,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroX,this.zeroX,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absX,this.absX,this.imm,this.indX,this.imm,this.indX,this.zero,this.zero,this.zero,this.zero,this.imp,this.imm,this.imp,this.imm,this.abs,this.abs,this.abs,this.abs,this.rel,this.indY,this.imp,this.indY,this.zeroX,this.zeroX,this.zeroX,this.zeroX,this.imp,this.absY,this.imp,this.absY,this.absX,this.absX,this.absX,this.absX].map((t=>t.bind(this))),this.instructionLookup=[this.BRK,this.ORA,this.KIL,this.NOP,this.NOP,this.ORA,this.ASL,this.NOP,this.PHP,this.ORA,this.ASL,this.NOP,this.NOP,this.ORA,this.ASL,this.NOP,this.BPL,this.ORA,this.KIL,this.NOP,this.NOP,this.ORA,this.ASL,this.NOP,this.CLC,this.ORA,this.NOP,this.NOP,this.NOP,this.ORA,this.ASL,this.NOP,this.JSR,this.AND,this.KIL,this.NOP,this.BIT,this.AND,this.ROL,this.NOP,this.PLP,this.AND,this.ROL,this.NOP,this.BIT,this.AND,this.ROL,this.NOP,this.BMI,this.AND,this.KIL,this.NOP,this.NOP,this.AND,this.ROL,this.NOP,this.SEC,this.AND,this.NOP,this.NOP,this.NOP,this.AND,this.ROL,this.NOP,this.RTI,this.EOR,this.KIL,this.NOP,this.NOP,this.EOR,this.LSR,this.NOP,this.PHA,this.EOR,this.LSR,this.NOP,this.JMP,this.EOR,this.LSR,this.NOP,this.BVC,this.EOR,this.KIL,this.NOP,this.NOP,this.EOR,this.LSR,this.NOP,this.CLI,this.EOR,this.NOP,this.NOP,this.NOP,this.EOR,this.LSR,this.NOP,this.RTS,this.ADC,this.KIL,this.NOP,this.NOP,this.ADC,this.ROR,this.NOP,this.PLA,this.ADC,this.ROR,this.NOP,this.JMP,this.ADC,this.ROR,this.NOP,this.BVS,this.ADC,this.KIL,this.NOP,this.NOP,this.ADC,this.ROR,this.NOP,this.SEI,this.ADC,this.NOP,this.NOP,this.NOP,this.ADC,this.ROR,this.NOP,this.NOP,this.STA,this.NOP,this.NOP,this.STY,this.STA,this.STX,this.NOP,this.DEY,this.NOP,this.TXA,this.NOP,this.STY,this.STA,this.STX,this.NOP,this.BCC,this.STA,this.KIL,this.NOP,this.STY,this.STA,this.STX,this.NOP,this.TYA,this.STA,this.TXS,this.NOP,this.NOP,this.STA,this.NOP,this.NOP,this.LDY,this.LDA,this.LDX,this.NOP,this.LDY,this.LDA,this.LDX,this.NOP,this.TAY,this.LDA,this.TAX,this.NOP,this.LDY,this.LDA,this.LDX,this.NOP,this.BCS,this.LDA,this.KIL,this.NOP,this.LDY,this.LDA,this.LDX,this.NOP,this.CLV,this.LDA,this.TSX,this.NOP,this.LDY,this.LDA,this.LDX,this.NOP,this.CPY,this.CMP,this.NOP,this.NOP,this.CPY,this.CMP,this.DEC,this.NOP,this.INY,this.CMP,this.DEX,this.NOP,this.CPY,this.CMP,this.DEC,this.NOP,this.BNE,this.CMP,this.KIL,this.NOP,this.NOP,this.CMP,this.DEC,this.NOP,this.CLD,this.CMP,this.NOP,this.NOP,this.NOP,this.CMP,this.DEC,this.NOP,this.CPX,this.SBC,this.NOP,this.NOP,this.CPX,this.SBC,this.INC,this.NOP,this.INX,this.SBC,this.NOP,this.NOP,this.CPX,this.SBC,this.INC,this.NOP,this.BEQ,this.SBC,this.KIL,this.NOP,this.NOP,this.SBC,this.INC,this.NOP,this.SED,this.SBC,this.NOP,this.NOP,this.NOP,this.SBC,this.INC,this.NOP].map((t=>t.bind(this))),this.isPowered=!1}powerOn(){this.cycle=0,this.cycleOffset=0,this.ppu=this.bus.ppu,this.ctrl1=this.bus.ctrlConnector.controllers[0],this.ctrl2=this.bus.ctrlConnector.controllers[1],this.cart=this.bus.cartConnector.cartridge;let t=this.bus.cartConnector.cartridge;this.nmiVector=()=>t.cpuRead(65530)+256*t.cpuRead(65531),this.resetVector=()=>t.cpuRead(65532)+256*t.cpuRead(65533),this.irqVector=()=>t.cpuRead(65534)+256*t.cpuRead(65535),this.A=0,this.X=0,this.Y=0,this.P=52,this.SP=253,this.PC=this.resetVector(),this.apu.powerOn(),this.isPowered=!0}powerOff(){this.apu.powerOff(),this.isPowered=!1}reset(){this.apu.reset(),this.doReset()}doInstructions(t=0){for(t+=this.cycleOffset;this.cycle<=t;){let t=this.doInstruction();this.apu.doCycles(t)}}doInstruction(){this.opcode=this.read(this.PC++),this.operand=this.read(this.PC++);const t=this.cycle;return this.instructionLookup[this.opcode]((t=>this.addressLookup[this.opcode](t))),this.cycle+=m[this.opcode],this.cycle-t}doNMI(){this.pushWord(this.PC),this.pushByte(-17&this.P),this.PC=this.nmiVector(),this.cycle+=7}doReset(){this.SP=this.SP+3,this.Interrupt=!1,this.PC=this.resetVector(),this.cycle+=7}doIRQ(){this.Interrupt||(this.pushWord(this.PC),this.pushByte(-17&this.P),this.PC=this.irqVector(),this.cycle+=7)}read(t){return t<2048?this.ram[t]:t<8192?this.ram[2047&t]:t<16408?t<16384?this.ppu.readRegister(t):16406===t?t>>>8|this.ctrl1.read():16407===t?t>>>8|this.ctrl2.read():this.apu.readRegister(t):this.cart.cpuRead(t)}write(t,s){if(t<2048)this.ram[t]=s;else if(t<8192)this.ram[2047&t]=s;else if(t<16408)if(t<16384)this.ppu.writeRegister(t,s);else if(16404===t){let t=256*s;for(let s=0;s<256;s++)this.ppu.OAMData=this.read(t++);1&this.cycle?this.cycle+=513:this.cycle+=514}else 16406===t?(this.ctrl1.write(s),this.ctrl2.write(s)):this.apu.writeRegister(t,s);else this.cart.cpuWrite(t,s)}get SP(){return this._SP}set SP(t){this._SP=f(t)}pushByte(t){this.stack[this.SP--]=t}pushWord(t){this.pushByte(t>>8),this.pushByte(255&t)}pullByte(){return this.SP++,this.stack[this.SP]}pullWord(){return this.pullByte()+256*this.pullByte()}get Carry(){return 1&this.P}get Zero(){return 2&this.P}get Interrupt(){return 4&this.P}get Decimal(){return 8&this.P}get Overflow(){return 64&this.P}get Negative(){return 128&this.P}set Carry(t){t?this.P|=1:this.P&=-2}set Zero(t){t?this.P|=2:this.P&=-3}set Interrupt(t){t?this.P|=4:this.P&=-5}set Decimal(t){t?this.P|=8:this.P&=-9}set Overflow(t){t?this.P|=64:this.P&=-65}set Negative(t){t?this.P|=128:this.P&=-129}get A(){return this._A}get X(){return this._X}get Y(){return this._Y}set A(t){this._A=this.ALU(t)}set X(t){this._X=this.ALU(t)}set Y(t){this._Y=this.ALU(t)}ALU(t){if(t>255)for(this.Carry=!0;t>255;)t-=256;if(this.Zero=0===t,t<0)for(this.Negative=!0;t<0;)t+=256;else this.Negative=t>=128;return t}imp(t){return this.PC--,t}imm(){return this.PC-1}rel(){return this.cycle++,(t=this.operand)>127?t-256:t;var t}zero(){return this.operand}zeroX(){return f(this.operand+this.X)}zeroY(){return f(this.operand+this.Y)}readWord(){return this.operand+=256*this.read(this.PC++)}abs(){return this.readWord()}absX(){return this.operand+this.X>255&&this.cycle++,this.readWord()+this.X}absY(){return this.operand+this.Y>255&&this.cycle++,this.readWord()+this.Y}ind(){let t=this.readWord();return this.read(t)+256*this.read(t+1)}indX(){let t=f(this.operand+this.X);return this.read(t)+256*this.read(t+1)}indY(){let t=this.read(this.operand)+256*this.read(this.operand+1);return f(t)+this.Y>255&&this.cycle++,t+this.Y}BRK(t){this.pushWord(this.PC),this.pushByte(this.P),this.Interrupt=!0,this.PC=t(this.irqVector())}RTI(t){this.P=this.pullByte(),this.PC=t(this.pullWord())}JSR(t){this.pushWord(this.PC),this.PC=t()}RTS(t){this.PC=t(this.pullWord()+1)}JMP(t){this.PC=t()}BPL(t){this.Negative||(this.PC+=t())}BMI(t){this.Negative&&(this.PC+=t())}BVC(t){this.Overflow||(this.PC+=t())}BVS(t){this.Overflow&&(this.PC+=t())}BCC(t){this.Carry||(this.PC+=t())}BCS(t){this.Carry&&(this.PC+=t())}BNE(t){this.Zero||(this.PC+=t())}BEQ(t){this.Zero&&(this.PC+=t())}PHA(t){this.pushByte(t(this.A))}PHP(t){this.pushByte(t(this.P))}PLA(t){this.A=t(this.pullByte())}PLP(t){this.P=t(this.pullByte())}CLC(t){t(this.Carry=!1)}CLD(t){t(this.Decimal=!1)}CLI(t){t(this.Interrupt=!1)}CLV(t){t(this.Overflow=!1)}SEC(t){t(this.Carry=!0)}SED(t){t(this.Decimal=!0)}SEI(t){t(this.Interrupt=!0)}TAX(t){t(this.X=this.A)}TXA(t){t(this.A=this.X)}TAY(t){t(this.Y=this.A)}TYA(t){t(this.A=this.Y)}TSX(t){t(this.X=this.SP)}TXS(t){t(this.SP=this.X)}LDA(t){this.A=this.read(t())}LDX(t){this.X=this.read(t())}LDY(t){this.Y=this.read(t())}STA(t){this.write(t(),this.A)}STX(t){this.write(t(),this.X)}STY(t){this.write(t(),this.Y)}ADC(t){this.add(this.A,this.read(t()))}SBC(t){this.add(this.A,255-this.read(t()))}add(t,s){let e=t+s+this.Carry;this.Carry=!1,this.Overflow=(t^e)&(s^e)&128,this.A=e}ASL(t){let s;if(10===this.opcode)s=t(this.A),this.A=2*s;else{let e=t();s=this.read(e),this.write(e,this.ALU(2*s))}this.Carry=128&s}LSR(t){let s;if(74===this.opcode)s=t(this.A),this.A=s>>>1;else{let e=t();s=this.read(e),this.write(e,this.ALU(s>>>1))}this.Carry=1&s}ROL(t){let s;if(42===this.opcode)s=t(this.A),this.A=2*s+this.Carry;else{let e=t();s=this.read(e),this.write(e,this.ALU(2*s+this.Carry))}this.Carry=128&s}ROR(t){let s;if(106===this.opcode)s=t(this.A),this.A=(s>>>1)+128*this.Carry;else{let e=t();s=this.read(e),this.write(e,this.ALU((s>>>1)+128*this.Carry))}this.Carry=1&s}INC(t){let s=t();this.write(s,this.ALU(this.read(s)+1))}DEC(t){let s=t();this.write(s,this.ALU(this.read(s)-1))}INX(t){this.X=t(this.X)+1}DEX(t){this.X=t(this.X)-1}INY(t){this.Y=t(this.Y)+1}DEY(t){this.Y=t(this.Y)-1}BIT(t){let s=this.read(t());this.Negative=s>=128,this.Negative?this.Overflow=s>=192:this.Overflow=s>=64,this.Zero=!(this.A&s)}CMP(t){this.compare(this.A,this.read(t()))}CPX(t){this.compare(this.X,this.read(t()))}CPY(t){this.compare(this.Y,this.read(t()))}compare(t,s){this.ALU(t+(256-s)),this.Carry=t>=s}ORA(t){this.A=this.A|this.read(t())}AND(t){this.A=this.A&this.read(t())}EOR(t){this.A=this.A^this.read(t())}NOP(t){t()}KIL(t){this.doReset()}}const C=new Uint32Array([4283716692,4285799936,4287631368,4287103024,4284743748,4281335900,4278191188,4278196284,4278200864,4278204936,4278206464,4278205440,4282135040,4278190080,4278190080,4278190080,4288190104,4291054600,4293669424,4293140060,4289729672,4284748960,4280296088,4278205560,4278213204,4278219304,4278221832,4280841728,4286080512,4278190080,4278190080,4278190080,4293717740,4293696076,4293688440,4293681840,4293678308,4290009324,4284771052,4280322260,4278233760,4278240372,4280340556,4285320248,4291605560,4282137660,4278190080,4278190080,4293717740,4293708968,4293704892,4293702356,4293701356,4292128492,4289770732,4287677668,4286108364,4286111412,4287685288,4290044568,4293187232,4288717472,4278190080,4278190080]);var P=Object.freeze({__proto__:null,pxlColors:C,cssColors:["#545454","#001E74","#081090","#300088","#440064","#5C0030","#540400","#3C1800","#202A00","#083A00","#004000","#003C00","#00323C","#000000","#000000","#000000","#989698","#084CC4","#3032EC","#5C1EE4","#8814B0","#A01464","#982220","#783C00","#545A00","#287200","#087C00","#007628","#006678","#000000","#000000","#000000","#ECEEEC","#4C9AEC","#787CEC","#B062EC","#E454EC","#EC58B4","#EC6A64","#D48820","#A0AA00","#74C400","#4CD020","#38CC6C","#38B4CC","#3C3C3C","#000000","#000000","#ECEEEC","#A8CCEC","#BCBCEC","#D4B2EC","#ECAEEC","#ECAED4","#ECB4B0","#E4C490","#CCD278","#B4DE78","#A8E290","#98E2B4","#A0D6E4","#A0A2A0","#000000","#000000"]});class g{constructor(t,s){this.width=t,this.height=s,this.createNewBuffer()}createNewBuffer(){"function"==typeof ImageData?(this.image=new ImageData(this.width,this.height),this.data=new Uint32Array(this.image.data.buffer)):(this.image=null,this.data=new Uint32Array(this.width*this.height))}writePixels(t,s,e){this.data.set(e,s*this.width+t)}getFrame(){let t=this.image;return this.createNewBuffer(),t}}const{pxlColors:A,cssColors:y}=P,b={0:0,32768:1,128:2,32896:3};class B{constructor(t){this.bus=t,this.vblank=!1,this.vram=new Uint8Array(2048),this.vramBank=[this.vram.subarray(0,1024),this.vram.subarray(1024,2048)],this.oamPrimary=new Uint8Array(256),this.oamSecondary=new Uint8Array(32),this.oamAddress=0,this.oamIndex=0,this.palette=[new Uint8Array(16),new Uint8Array(16)],this.bkgPixelsBuffer=new Uint32Array(16),this.sprPixelsBuffer=new Uint32Array(8),this.bkgLayer=new g(264,256),this.sprBehindLayer=new g(264,256),this.sprInFrontLayer=new g(264,256),this.sprLayer=this.sprInFrontLayer,this.sprite0Layer=new Uint32Array(264),this.isPowered=!1}powerOn(){this.control=null,this.mask=null,this.status=null,this.OAMAddress=null,this.oamPrimary.fill(0),this.scroll=null,this.address=null,this.data=null,this.ntsc="NTSC"===this.bus.cartConnector.metadata.tvSystem,this.cpu=this.bus.cpu,this.cart=this.bus.cartConnector.cartridge,this.output=this.bus.videoOutput,this.output.addLayer(this.sprBehindLayer),this.output.addLayer(this.bkgLayer),this.output.addLayer(this.sprInFrontLayer),this.output.start(),this.isPowered=!0}powerOff(){this.output.stop(),this.isPowered=!1}reset(){this.control=null,this.mask=null,this.scroll=null,this.data=null}doVBlank(){this.vblank=!0,this.nmiEnabled&&this.cpu.doNMI()}endVBlank(){this.status=null}set control(t){null!==t?(this.addressBuffer&=-3073,this.addressBuffer|=(3&t)<<10,this.addressIncrement=4&t?32:1,this.sprPatternTable=8&t?4096:0,this.bkgPatternTable=16&t?4096:0,this.sprite8x16=!!(32&t),this.nmiEnabled=!!(128&t)):(this.addressIncrement=1,this.sprPatternTable=0,this.bkgPatternTable=0,this.sprite8x16=!1,this.nmiEnabled=!1),this.spriteHeight=this.sprite8x16?16:8}set mask(t){t?(this.grayscale=!!(1&t),this.showLeftMostBkg=!!(2&t),this.showLeftMostSpr=!!(4&t),this.showBackground=!!(8&t),this.showSprites=!!(16&t),this.emphasizeRed=!!(t&(this.ntsc?32:64)),this.emphasizeGreen=!!(t&(this.ntsc?64:32)),this.emphasizeBlue=!!(128&t),this.renderingEnabled=!!(24&t)):(this.grayscale=!1,this.showLeftMostBkg=!1,this.showLeftMostSpr=!1,this.showBackground=!1,this.showSprites=!1,this.emphasizeRed=!1,this.emphasizeGreen=!1,this.emphasizeBlue=!1,this.renderingEnabled=!1)}get status(){let t=(this.spriteOverflow&&32)|(this.sprite0Hit&&64)|(this.vblank&&128);return this.vblank=!1,this.writeToggle=!1,t}set status(t){this.spriteOverflow=!1,this.sprite0Hit=!1,this.sprite0=!1,this.vblank=!1}set OAMAddress(t){this.oamAddress=t||0}get OAMData(){return this.oamPrimary[this.oamAddress]}set OAMData(t){this.oamPrimary[this.oamAddress++]=t,this.oamAddress>255&&(this.oamAddress=0)}set scroll(t){if(null!==t){let s=this.writeToggle,e=this.addressBuffer;s?(e&=3103,e|=(7&t)<<12,e|=(248&t)<<2,this.fineScrollY=7&t):(e&=32736,e|=t>>>3,this.fineScrollX=7&t),this.addressBuffer=e,this.writeToggle=!s}else this.writeToggle=!1,this.fineScrollX=0,this.fineScrollY=0}set address(t){if(null!==t){let s=this.writeToggle;s?(this.addressBuffer=65280&this.addressBuffer|t,this.addressBus=this.addressBuffer):(t=(63&t)<<8,this.addressBuffer=255&this.addressBuffer|t),this.writeToggle=!s}else this.writeToggle=!1,this.addressBus=this.addressBuffer=0}get data(){let t,s=this.addressBus;return t=s>=16128?this.readPalette(s):this.readBuffer,this.readBuffer=this.read(s),this.addressBus=s+this.addressIncrement,t}set data(t){if(null!==t){let s=this.addressBus;s>=16128?this.writePalette(s,t):this.write(s,t),this.addressBus=s+this.addressIncrement}else this.readBuffer=0}readRegister(t){switch(t>8199&&(t&=8199),t){case 8194:return this.status;case 8196:return this.OAMData;case 8199:return this.data;default:return 0}}writeRegister(t,s){switch(t>8199&&(t&=8199),t){case 8192:this.control=s;break;case 8193:this.mask=s;break;case 8195:this.OAMAddress=s;break;case 8196:this.OAMData=s;break;case 8197:this.scroll=s;break;case 8198:this.address=s;break;case 8199:this.data=s}}read(t){let s=this.cart;return s.ciramEnabled(t)?this.vramBank[s.ciramA10(t)?1:0][1023&t]:s.ppuRead(t)}write(t,s){let e=this.cart;e.ciramEnabled(t)?this.vramBank[e.ciramA10(t)?1:0][1023&t]=s:e.ppuWrite(t,s)}get backdrop(){return this.palette[0][0]}get bkgPalette(){return this.palette[0]}get sprPalette(){return this.palette[1]}readPalette(t){return 3&t?this.palette[(16&t)>>>4][15&t]:this.palette[0][0]}writePalette(t,s){3&t?this.palette[(16&t)>>>4][15&t]=s:this.palette[0][15&t]=s}incrementX(){if(!this.renderingEnabled)return;let t=this.addressBus;31==(31&t)?(t&=32736,t^=1024):t++,this.addressBus=t}incrementY(){if(!this.renderingEnabled)return;let t=this.addressBus;if(t<28672)t+=4096,this.fineScrollY++;else{t-=28672;let s=992&t;928===s?(t&=3103,t^=2048):992===s?t&=64543:t+=32,this.fineScrollY=t>>>12}this.addressBus=t}resetX(){if(!this.renderingEnabled)return;let t=this.addressBus;t&=31712,t|=1055&this.addressBuffer,this.addressBus=t}resetY(){if(!this.renderingEnabled)return;let t=this.addressBus;t&=1055,t|=31712&this.addressBuffer,this.addressBus=t,this.fineScrollY=t>>>12}fetchNameTable(t){let s=8192+(4095&t);return this.read(s)}fetchAttributeTable(t){let s=9152|3072&t|t>>>4&56|t>>>2&7,e=0;return 2&t&&(e+=2),64&t&&(e+=4),this.read(s)>>>e&3}fetchBkgPatternTable(t,s){let e=this.bkgPatternTable+16*t+s;return 256*this.read(e)+this.read(e+8)}fetchTile(){if(!this.showBackground)return;let t=this.addressBus,s=this.fetchNameTable(t),e=this.fetchAttributeTable(t),i=this.fetchBkgPatternTable(s,this.fineScrollY);this.bkgPixelsBuffer.copyWithin(0,8),this.setPatternPixels(this.bkgPixelsBuffer.subarray(8),i,this.bkgPalette,e)}fetchNullTile(){if(!this.showBackground)return;let t=this.addressBus,s=this.fetchNameTable(t);this.fetchAttributeTable(t),this.fetchBkgPatternTable(s,this.fineScrollY)}fetchNullNTs(){if(!this.showBackground)return;let t=this.addressBus;this.fetchNameTable(t),this.fetchNameTable(t)}renderTile(t,s){if(!this.showBackground)return;let e=this.fineScrollX,i=this.bkgPixelsBuffer.subarray(e,e+8);this.sprite0&&!this.sprite0Hit&&this.sprite0Layer.subarray(t,t+8).some(((t,s)=>t&&i[s]))&&(this.sprite0Hit=!0),this.bkgLayer.writePixels(t,s,i)}clearSecondaryOAM(){this.oamSecondary.fill(255),this.oamIndex=0}evaluateSprites(t){let s=this.oamPrimary,e=this.oamSecondary,i=this.spriteHeight;for(;this.oamAddress<256;){let h=s[this.oamAddress],r=h+i,n=h;if(32===this.oamIndex)this.oamAddress++,this.oamIndex++;else{if(this.oamIndex<32&&(e[this.oamIndex]=h),t>=n&&t<r){if(!(this.oamIndex<32)){this.spriteOverflow=!0;break}0===this.oamAddress&&(this.sprite0=!0);for(let t=1;t<4;t++)e[this.oamIndex+t]=s[this.oamAddress+t];this.oamIndex+=4}this.oamAddress+=4}}this.oamIndex=0}fetchSprPatternTable(t,s){let e=this.sprPatternTable;this.sprite8x16&&(e=(1&t)<<12,t&=254);let i=e+16*t+s;return 256*this.read(i)+this.read(i+8)}fetchSprite(t){if(!this.showSprites)return;let s=this.addressBus;this.fetchNameTable(s),this.fetchAttributeTable(s),this.oamAddress=0;let e=this.oamSecondary;this.sprite0&&(this.sprite0=0===this.oamIndex);let i,h=t-e[this.oamIndex++],r=e[this.oamIndex++],n=e[this.oamIndex++];n>=128&&(h=this.spriteHeight-h-1,n-=128),n>=64&&(i=!0,n-=64),n>=32?(this.sprLayer=this.sprBehindLayer,n-=32):this.sprLayer=this.sprInFrontLayer,h>=8&&(h-=8,r++);let a=this.fetchSprPatternTable(r,h);this.setPatternPixels(this.sprPixelsBuffer,a,this.sprPalette,n,i)}fetchNullSprite(){if(!this.showSprites)return;let t=this.addressBus;this.fetchNameTable(t),this.fetchAttributeTable(t),this.fetchSprPatternTable(this.sprPatternTable,255)}renderSprite(t){if(!this.showSprites)return;let s=this.oamSecondary[this.oamIndex++],e=this.sprPixelsBuffer;this.sprite0&&this.sprite0Layer.fill(0).set(e,s),this.sprLayer.writePixels(s,t+1,e)}setPatternPixels(t,s,e,i,h){i>=4&&(i%=4);let r=4*i;for(let i=0;i<8;i++){let n=b[s<<i&32896];t[h?7-i:i]=n?A[e[r+n]]:0}}printFrame(){this.output.schedule(y[this.backdrop])}}const M=1e3/60,O=341/3,N=29780.5,w=27393.666666666668,S=29659;class L{constructor(t){this.bus=t,this.firstLoop=this.firstLoop.bind(this),this.mainLoop=this.mainLoop.bind(this),this.runningLoop=null,this.init(),this.isPowered=!1,this.isPaused=!1}init(){this.frame=0,this.dropped=0,this.fps=60,this.performance=1,this._delta=0,this._lastTimestamp=0,this._frameTimeThisSecond=0,this._framesThisSecond=0,this._fps=60}powerOn(){this.cpu=this.bus.cpu,this.ppu=this.bus.ppu,this.init(),this.coldBoot(),this.isPowered=!0,this.isPaused=!1}powerOff(){clearTimeout(this.runningLoop),this.runningLoop=null,this.isPowered=!1,this.isPaused=!1}pause(){return this.isPaused?(this.runningLoop=setTimeout(this.firstLoop,0),this.isPaused=!1):(clearTimeout(this.runningLoop),this.runningLoop=null,this.isPaused=this.isPowered),this.isPaused}coldBoot(){let t=this.cpu,s=this.ppu;t.cycleOffset=0,t.doInstructions(2279),s.vblank=!0,t.doInstructions(4757),s.vblank=!0,t.doInstructions(w),s.doVBlank(),t.doInstructions(S),s.endVBlank(),this.doPreFetch(t,s,261),this.runningLoop=setTimeout(this.firstLoop,0)}firstLoop(){if("undefined"==typeof window)return;let t=window.performance.now(),s=this.cpu,e=this.ppu;this.doFrame(s,e),this.updateStats(window.performance.now()-t),this._lastTimestamp=t,this.runningLoop=setTimeout(this.mainLoop,0)}mainLoop(){let t=window.performance.now();if(this._delta=t-this._lastTimestamp,this._delta>=M){if(this._delta>1e3)return void this.pause();let s=this.cpu,e=this.ppu;for(;(this._delta-=M)>=M;)this.skipFrame(s,e),this._fps--;this.doFrame(s,e),this.updateStats(window.performance.now()-t),this._lastTimestamp=t}this.runningLoop=setTimeout(this.mainLoop,0)}updateStats(t){this._frameTimeThisSecond+=t,this._framesThisSecond++,this._framesThisSecond>=this._fps&&(this.performance=1e3/this._frameTimeThisSecond,this.fps=this._fps,this._frameTimeThisSecond=0,this._framesThisSecond=0,this._fps=60)}doFrame(t,s){t.cycleOffset=this.frame*N;for(let e=0;e<=239;e++)this.doScanline(t,s,e);t.doInstructions(w),s.printFrame(),s.doVBlank(),t.doInstructions(S),s.endVBlank(),this.doPreRenderLine(t,s),this.frame++}skipFrame(t,s){t.cycleOffset=this.frame*N,t.doInstructions(w),s.doVBlank(),t.doInstructions(S),s.endVBlank(),t.doInstructions(N),this.frame++,this.dropped++}doScanline(t,s,e){let i=e*O,h=0;for(s.clearSecondaryOAM();h<64;)t.doInstructions(i+h/3),s.renderTile(h,e),s.fetchTile(),s.incrementX(),h+=8;for(s.evaluateSprites(e);h<248;)t.doInstructions(i+h/3),s.renderTile(h,e),s.fetchTile(),s.incrementX(),h+=8;for(t.doInstructions(i+h/3),s.renderTile(h,e),s.fetchNullTile(),s.incrementY(),s.resetX(),h+=8;h<320;)t.doInstructions(i+h/3),s.fetchSprite(e),s.renderSprite(e),h+=8;this.doPreFetch(t,s,e)}doPreRenderLine(t,s){let e=29667,i=0;for(;i<256;)t.doInstructions(e+i/3),s.fetchNullTile(),s.incrementX(),i+=8;for(s.incrementY(),s.resetX();i<279;)t.doInstructions(e+i/3),s.fetchNullSprite(),i+=8;for(;i<304;)t.doInstructions(e+i/3),s.fetchNullSprite(),s.resetY(),i+=8;for(;i<320;)t.doInstructions(e+i/3),s.fetchNullSprite(),i+=8;this.doPreFetch(t,s,261)}doPreFetch(t,s,e){let i=e*O,h=320;for(;h<336;)t.doInstructions(i+h/3),s.fetchTile(),s.incrementX(),h+=8;s.fetchNullNTs()}}class v{constructor(t){this.loaded=!1,this.format="Unknown",this.valid=!1,this.mapperNumber=-1,this.mapperName="",this.supported=!1,this.PRGROMByteLength=0,this.CHRROMByteLength=0,this.horiMirroring=!1,this.vertMirroring=!1,this.battery=!1,this.trainer=!1,this.consoleType=0,this.PRGRAMByteLength=0,this.CHRRAMByteLength=0,this.PRGNVRAMByteLength=0,this.CHRNVRAMByteLength=0,t&&this.parse(t)}get byteLength(){return 0}parse(t){return this.loaded=!!t.byteLength&&t.byteLength>=this.byteLength}}const T=16384,E=4096;class I{constructor(){this.PRGRAM=new Uint8Array(T),this.CHRRAM=new Uint8Array(E),this.PRGROM=[],this.firstPRGBank=this.PRGRAM,this.lastPRGBank=this.PRGRAM,this.PRGBank=[this.firstPRGBank,this.lastPRGBank],this.CHRROM=[],this.firstCHRBank=this.CHRRAM,this.secondCHRBank=this.CHRRAM,this.CHRBank=[this.firstCHRBank,this.secondCHRBank],this.horiMirroring=!1,this.vertMirroring=!1}load(t,s){let e=t.byteLength;this.horiMirroring=t.horiMirroring,this.vertMirroring=t.vertMirroring,t.trainer&&(this.PRGRAM.set(new Uint8Array(s,e,512),4096),e+=512);const i=t.PRGROMByteLength/T;if(i>0){for(let t=0;t<i;t++)this.PRGROM.push(new Uint8Array(s,e,T)),e+=T;this.firstPRGBank=this.PRGROM[0],this.lastPRGBank=this.PRGROM[this.PRGROM.length-1]}this.PRGBank=[this.firstPRGBank,this.lastPRGBank];const h=t.CHRROMByteLength/E;if(h>0){for(let t=0;t<h;t++)this.CHRROM.push(new Uint8Array(s,e,E)),e+=E;this.firstCHRBank=this.CHRROM[0],this.secondCHRBank=this.CHRROM[1]}this.CHRBank=[this.firstCHRBank,this.secondCHRBank]}cpuRead(t){if(t>=49152)return this.PRGBank[1][t-49152];if(t>=32768)return this.PRGBank[0][t-32768];for(t>=24576&&(t-=24576);t>8191;)t-=8192;return this.PRGRAM[t]}cpuWrite(t,s){for(t>=24576&&(t-=24576);t>8191;)t-=8192;this.PRGRAM[t]=s}ppuRead(t){if(t<4096)return this.CHRBank[0][t];if(t<8192)return this.CHRBank[1][t-4096];for(t-=8192;t>4095;)t-=4096;return this.CHRBank[1][t]}ppuWrite(t,s){for(;t>8191;)t-=8192;this.CHRRAM[t]=s}ciramA10(t){return 0}ciramEnabled(t){return t<8192?0:t<16384?8192:8192&t}}class k extends I{ciramA10(t){return t<1024?0:this.vertMirroring?1024&t:t<2048?0:this.horiMirroring?2048&t:0}}var D=Object.freeze(["NROM","Nintendo MMC1","UNROM","CNROM","Nintendo MMC3","Nintendo MMC5","FFE Rev. A","ANROM","","Nintendo MMC2","Nintendo MMC4","Color Dreams","REX DBZ 5","CPROM","REX SL-1632","100-in-1","BANDAI 24C02","FFE Rev. B","JALECO SS880006","Namcot 163","","Konami VRC4a/VRC4c","Konami VRC2a","Konami VRC2b/VRC4e","Konami VRC6a","Konami VRC4b/VRC4d","Konami VRC6b","CC-21 MI HUN CHE","","","","","IREM G-101","TC0190FMC/TC0350FMR","IREM I-IM/BNROM","Wario Land 2","TXC Policeman","PAL-ZZ SMB/TETRIS/NWC","Bit Corp.","","SMB2j FDS","CALTRON 6-in-1","BIO MIRACLE FDS","FDS SMB2j LF36","MMC3 BMC PIRATE A","MMC3 BMC PIRATE B","RUMBLESTATION 15-in-1","NES-QJ SSVB/NWC","TAITO TCxxx","MMC3 BMC PIRATE C","SMB2j FDS Rev. A","11-in-1 BALL SERIES","MMC3 BMC PIRATE D","SUPERVISION 16-in-1","","","","SIMBPLE BMC PIRATE A","SIMBPLE BMC PIRATE B","","SIMBPLE BMC PIRATE C","20-in-1 KAISER Rev. A","700-in-1","","TENGEN RAMBO1","IREM-H3001","MHROM","SUNSOFT-FZII","Sunsoft Mapper #4","SUNSOFT-5/FME-7","BA KAMEN DISCRETE","CAMERICA BF9093","JALECO JF-17","KONAMI VRC3","TW MMC3+VRAM Rev. A","KONAMI VRC1","NAMCOT 108 Rev. A","IREM LROG017","Irem 74HC161/32","AVE/C&E/TXC BOARD","TAITO X1-005 Rev. A","","TAITO X1-017","YOKO VRC Rev. B","","KONAMI VRC7","JALECO JF-13","74*139/74 DISCRETE","NAMCO 3433","SUNSOFT-3","HUMMER/JY BOARD","EARLY HUMMER/JY BOARD","JALECO JF-19","SUNSOFT-3R","HVC-UN1ROM","NAMCOT 108 Rev. B","BANDAI OEKAKIDS","IREM TAM-S1","","VS Uni/Dual- system","","","","FDS DOKIDOKI FULL","","NES-EVENT NWC1990","SMB3 PIRATE A","MAGIC CORP A","FDS UNROM BOARD","","","","ASDER/NTDEC BOARD","HACKER/SACHEN BOARD","MMC3 SG PROT. A","MMC3 PIRATE A","MMC1/MMC3/VRC PIRATE","FUTURE MEDIA BOARD","TSKROM","NES-TQROM","FDS TOBIDASE","MMC3 PIRATE PROT. A","","MMC3 PIRATE H2288","","FDS LH32","","","","","","","TXC/MGENIUS 22111","SA72008","MMC3 BMC PIRATE","","TCU02","S8259D","S8259B","S8259C","JALECO JF-11/14","S8259A","UNLKS7032","TCA01","AGCI 50282","SA72007","SA0161M","TCU01","SA0037","SA0036","S74LS374N","","","BANDAI SRAM","","","","BANDAI BARCODE","","BANDAI 24C01","SA009","","","","","","SUBOR Rev. A","SUBOR Rev. B","","","","","","","","","BMCFK23C","","","","","","","","","","","","","","","","TW MMC3+VRAM Rev. B","NTDEC TC-112","TW MMC3+VRAM Rev. C","TW MMC3+VRAM Rev. D","","","TW MMC3+VRAM Rev. E","","","","","","","","NAMCOT 108 Rev. C","TAITO X1-005 Rev. B","","","","","","","","","","","","UNLA9746","Debug Mapper","UNLN625092","","","","","BMC 22+20-in-1","","","","BMC Contra+22-in-1","","BMC QUATTRO","BMC 22+20-in-1 RST","BMC MAXI","","","","UNL6035052","","","","","S74LS374NA","DECATHLON","","FONG SHEN BANG","","","","","","SAN GUO ZHI PIRATE","DRAGON BALL PIRATE","",""]);const X=Object.freeze([k,class extends I{constructor(){super(),this.mirroring=0,this.PRGBankMode=3,this.CHRBankMode=0,this.buffer=0,this.index=0}set control(t){this.mirroring=3&t,this.PRGBankMode=(12&t)>>2,this.CHRBankMode=(16&t)>>4}set CHR0(t){if(1===this.CHRBankMode)this.CHRBank[0]=this.CHRROM[t];else{let s=-2&t;this.CHRBank[0]=this.CHRROM[s+0],this.CHRBank[1]=this.CHRROM[s+1]}}set CHR1(t){1===this.CHRBankMode&&(this.CHRBank[1]=this.CHRROM[t])}set PRG(t){for(;t>=16;)t-=16;if(3===this.PRGBankMode)this.PRGBank[0]=this.PRGROM[t],this.PRGBank[1]=this.lastPRGBank;else if(2===this.PRGBankMode)this.PRGBank[0]=this.firstPRGBank,this.PRGBank[1]=this.PRGROM[t];else{let s=-2&t;this.PRGBank[0]=this.PRGROM[s+0],this.PRGBank[1]=this.PRGROM[s+1]}}write(t,s){switch(t-32768){case 0:this.control=s;break;case 8192:this.CHR0=s;break;case 16384:this.CHR1=s;break;case 24576:this.PRG=s;break;default:this.write(57344&t,s)}}cpuWrite(t,s){t>=32768?s>=128?(this.buffer=0,this.index=0,this.mirroring=0,this.CHRBankMode=0):(this.buffer+=(1&s)<<this.index,5==++this.index&&(this.write(t,this.buffer),this.buffer=0,this.index=0)):super.cpuWrite(t,s)}ciramA10(t){return 3===this.mirroring?t<2048?0:2048&t:2===this.mirroring?t<1024?0:1024&t:this.mirroring}}]);class H{constructor(t){return new(X[t]||k)}static supported(t){return void 0!==X[t]}static name(t){return D[t]||"Unknown"}}const x=16384,V=8192;class U extends v{get byteLength(){return 16}parse(t){if(super.parse(t)){const s=new DataView(t,0,16);if(1313166106===s.getUint32(0)){this.valid=!0,this.format="Archaic iNES";const e=s.getUint8(4),i=s.getUint8(5);this.PRGROMByteLength=Y(x,e),this.CHRROMByteLength=Y(V,i);const h=s.getUint8(6);this.mapperNumber=h>>4,8&h?(this.horiMirroring=!1,this.vertMirroring=!1):1&h?(this.horiMirroring=!1,this.vertMirroring=!0):(this.horiMirroring=!0,this.vertMirroring=!1),this.battery=!!(2&h),this.trainer=!!(4&h);const r=s.getUint8(7);if(!(4&r))if(this.mapperNumber+=240&r,this.consoleType=3&r,8&r){const h=s.getUint8(9);Y(x,e,15&h)+Y(V,i,h>>4)<=t.byteLength&&this.parseV2(s)}else 0===s.getUint32(12)&&this.parseV1(s);this.mapperName=H.name(this.mapperNumber),this.supported=H.supported(this.mapperNumber)}}return this.loaded}parseV1(t){this.format="iNES",this.PRGRAMByteLength=8192*(t.getUint8(8)||1)}parseV2(t){this.format="NES 2.0",this.mapperNumber+=256*(15&t.getUint8(8));const s=t.getUint8(9);this.PRGROMByteLength=Y(x,t.getUint8(4),15&s),this.CHRROMByteLength=Y(V,t.getUint8(5),s>>4);const e=t.getUint8(10);this.PRGRAMByteLength=G(15&e),this.PRGNVRAMByteLength=G(e>>4);const i=t.getUint8(11);this.CHRRAMByteLength=G(15&i),this.CHRNVRAMByteLength=G(i>>4)}}function Y(t,s,e=0){if(e<15)return(s+256*e)*t;return 2^(s>>2)*(2*(3&s)+1)}function G(t){return t?64<<t:0}class F extends v{get byteLength(){return 32}parse(t){if(super.parse(t)){const s=new DataView(t,0,32);1431193926===s.getUint32(0)&&(this.format="UNIF v"+s.getUint32(4,!0))}return this.loaded}}const z=["NES/Famicom","Nintendo Vs. System","Nintendo Playchoice 10","Extended Console Type"],K="NTSC",_="PAL",W="SECAM";class q{constructor(){this.name="No Cartridge",this.format="",this.consoleType=z[0],this.tvSystem=K,this.mapper="",this.PRGROM="",this.CHRROM="",this.scrolling="",this.SRAM="",this.PRGRAM="",this.CHRRAM="",this.misc="",this.warnings=[],this.errors=[]}get supported(){return 0===this.warnings.length}get valid(){return 0===this.errors.length}warn(t){this.warnings.push(t)}error(t){this.errors.push(t)}parseFilename(t){const s=/\((U|E|Unk|Unl|1|4|A|J|B|K|C|NL|PD|F|S|FC|SW|FN|G|UK|GR|HK|I|H)+\)/.exec(t);s&&(s[0].search(/U[^Kn]|1|4|J|[^U]K|PD|FC|HK/)>0?this.tvSystem=K:s[0].search(/E|A|B|[^F]C|NL|S|SW|FN|G|UK|GR|I|H/)>0?this.tvSystem=_:s[0].search(/F[^C]/)>0&&(this.tvSystem=W),this.tvSystem!==K&&this.warn(`Unsupported TV system (${this.tvSystem})`)),this.name=t.replace(/\.[A-Za-z0-9_]+$/,"").replace(/\s?\((U|E|Unk|Unl|1|4|A|J|B|K|C|NL|PD|F|S|FC|SW|FN|G|UK|GR|HK|I|H)+\)/g,"").replace(/\s?\[(!|a|p|b|t|f|T[+-]|h|o)+\]/g,"").replace(/_+/g," ").trim(),this.name&&(this.name=this.name[0].toUpperCase()+this.name.slice(1))}load(t){this.format=t.format,this.mapper=`Mapper #${t.mapperNumber}: ${t.mapperName}`,t.supported||this.warn(`Unsupported mapper (#${t.mapperNumber}:${t.mapperName})`),this.PRGROM=t.PRGROMByteLength/1024+"kb of PRG-ROM",this.CHRROM=t.CHRROMByteLength/1024+"kb of CHR-ROM",t.horiMirroring&&t.vertMirroring?this.scrolling="Scrolling disabled (or Mapper controlled)":t.vertMirroring?this.scrolling="Horizontal scrolling":t.horiMirroring?this.scrolling="Vertical scrolling (or Mapper controlled)":this.scrolling="4-screens scrolling",t.battery&&(this.SRAM="Battery-backed SRAM"),t.trainer&&(this.misc="512b trainer data present"),t.PRGRAMByteLength&&t.PRGNVRAMByteLength?this.PRGRAM=(t.PRGRAMByteLength+t.PRGNVRAMByteLength)/1024+"kb of combined PRG-RAM/NVRAM":t.PRGNVRAMByteLength?this.PRGRAM=t.PRGNVRAMByteLength/1024+"kb of PRG-NVRAM":t.PRGRAMByteLength&&(this.PRGRAM=t.PRGRAMByteLength/1024+"kb of PRG-RAM"),t.CHRRAMByteLength&&t.CHRNVRAMByteLength?this.CHRRAM=(t.CHRRAMByteLength+t.CHRNVRAMByteLength)/1024+"kb of combined CHR-RAM/NVRAM":t.CHRNVRAMByteLength?this.CHRRAM=t.CHRNVRAMByteLength/1024+"kb of CHR-NVRAM":t.CHRRAMByteLength&&(this.CHRRAM=t.CHRRAMByteLength/1024+"kb of CHR-RAM"),this.consoleType=z[t.consoleType],t.consoleType>0&&this.warn(`Unsupported console type (${this.consoleType})`)}serialize(){return{name:this.name,format:this.format,consoleType:this.consoleType,tvSystem:this.tvSystem,mapper:this.mapper,PRGROM:this.PRGROM,CHRROM:this.CHRROM,scrolling:this.scrolling,SRAM:this.SRAM,PRGRAM:this.PRGRAM,CHRRAM:this.CHRRAM,misc:this.misc}}}class Q{constructor(){this.reset()}reset(){this.file=new v,this.metadata=new q,this.cartridge=new I}load(t){return this.reset(),new Promise(((s,e)=>{if(t)if(this.metadata.parseFilename(t.name),t.size){const i=new FileReader;i.onabort=()=>e(new DOMException),i.onerror=()=>e(i.error),i.onload=()=>s(i.result),i.readAsArrayBuffer(t)}else e(new Error("File is empty"));else e(new DOMException)})).then((t=>{const s=new DataView(t).getUint32(0);if(1313166106===s)this.file=new U(t);else{if(1431193926!==s)throw new Error("Invalid format");this.file=new F(t)}if(!this.file.valid)throw new Error(`Unsupported format (${this.file.format})`);return this.metadata.load(this.file),this.cartridge=new H(this.file.mapperNumber),this.cartridge.load(this.file,t),this})).catch((t=>(t instanceof DOMException?this.metadata.error("Loading aborted"):t.message?this.metadata.error(t.message):this.metadata.error("Loading failed"),this.cartridge=new I,this)))}unload(){return this.reset(),Promise.resolve(this)}}class J{constructor(t){this.type=t||"",this.strobing=!1,this.states=new Array(8).fill(0),this.strobe()}get empty(){return!this.type}get present(){return!!this.type}strobe(){this.data=[...this.states]}read(){this.strobing&&this.strobe();let t=this.data.shift();return void 0!==t?t:1}write(t){this.strobing=!!(1&t),this.strobing&&this.strobe()}}const j=Object.freeze({a:0,b:1,select:2,start:3,up:4,down:5,left:6,right:7});class Z extends J{constructor(){super("Joypad"),this.buttonHandlers=this.states.map(((t,s)=>t=>{this.states[s]=t?1:0}))}getButtonHandler(t){let s=j[t.toLowerCase()];if(null!=s)return this.buttonHandlers[s];throw new Error(`'${t}' is not a valid button name`)}}const $=Object.freeze({8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",27:"Escape",32:"Space",33:"Page-up",34:"Page-down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"Numpad-0",97:"Numpad-1",98:"Numpad-2",99:"Numpad-3",100:"Numpad-4",101:"Numpad-5",102:"Numpad-6",103:"Numpad-7",104:"Numpad-8",105:"Numpad-9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal-point",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"});var tt=Object.freeze({__proto__:null,Keyboard:class extends Z{constructor(t){super(),this.keyMap={},t&&this.assignKeys(t),"undefined"!=typeof window&&(window.addEventListener("keydown",(t=>this.pressKey(t,!0))),window.addEventListener("keyup",(t=>this.pressKey(t,!1))))}get map(){return $}assignKey(t,s){let e=this.getButtonHandler(t);Object.entries(this.keyMap).forEach((([t,s])=>{s===e&&delete this.keyMap[t]})),this.keyMap[s]=e}assignKeys(t){Object.entries(t).forEach((([t,s])=>this.assignKey(t,s)))}pressKey(t,s){let e=t.keyCode||t.which,i=this.keyMap[e];i&&(i(s),t.preventDefault())}}});class st{constructor(){this.controllers=[new J,new J]}insert(t){if(this.controllers.indexOf(t)>-1)return t;if(this.controllers[0].empty)this.controllers[0]=t;else{if(!this.controllers[1].empty)return;this.controllers[1]=t}return t}remove(t){let s=this.controllers.indexOf(t);if(s>-1)return this.controllers[s]=new J,t}}class et{constructor(){this.canvas=null,this.context=null,this.layers=[]}get connected(){return!!this.canvas}get disconnected(){return!this.canvas}connect(t){return t&&"CANVAS"===t.nodeName?(this.canvas=t,this.width=t.width,this.height=t.height,t):this.disconnect()}disconnect(){return this.canvas=null}addLayer(t){this.layers.push(t)}start(){this.connected&&(this.context=this.canvas.getContext("2d",{alpha:!1}),this.context.imageSmoothingEnabled=!1,this.offCanvas=document.createElement("canvas"),this.offCanvas.width=256,this.offCanvas.height=240,this.offContext=this.offCanvas.getContext("2d",{alpha:!0}),this.offContext.imageSmoothingEnabled=!1)}stop(){this.connected&&(window.cancelAnimationFrame(this.scheduled),this.layers=[],this.context=null,this.offCanvas.remove(),this.offContext=null)}schedule(t){if(this.connected){const s=this.layers.map((t=>t.getFrame()));this.scheduled=window.requestAnimationFrame((()=>{this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height),s.forEach((t=>{this.offContext.putImageData(t,0,0),this.context.drawImage(this.offCanvas,0,0,256,240,0,0,this.width,this.height)}))}))}}}const it=367,ht=24;class rt{constructor(t){this.buffers=new Array(ht).fill(null).map((()=>new AudioBuffer({length:it,sampleRate:t}))),this.duration=it/t,this.onnewbufferready=void 0,this.onbufferunderrun=void 0,this.onbufferoverrun=void 0,this.reset()}reset(){this.readyBuffer=this.writeBuffer=this.buffers[0],this.nextReadyIndex=this.nextWriteIndex=1,this.initChannelData()}initChannelData(){this.data=this.writeBuffer.getChannelData(0),this.index=0}get length(){return it}get buffersCount(){return ht}get readyBuffersCount(){const t=this.nextWriteIndex-this.nextReadyIndex;return t<0?t+ht:t}get usage(){return(this.readyBuffersCount+this.index/it)/ht}get ready(){return this.nextReadyIndex!==this.nextWriteIndex}get halfFull(){return this.readyBuffersCount>=12}shift(){if(!this.ready){const t=this.index,s=t&&this.data[t-1];this.data.fill(s,t),this.rotateWriteBuffer(),this.data=this.writeBuffer.getChannelData(0),this.data.fill(s,0,t),"function"==typeof this.onbufferunderrun&&this.onbufferunderrun((t/it-1)*this.duration)}const t=this.readyBuffer;return this.rotateReadyBuffer(),t}writeSample(t){this.data[this.index++]=t,this.index===it&&(1===this.usage&&"function"==typeof this.onbufferoverrun&&this.onbufferoverrun(this),this.rotateWriteBuffer(),this.ready?(this.initChannelData(),"function"==typeof this.onnewbufferready&&this.onnewbufferready(this)):(this.rotateWriteBuffer(),this.initChannelData()))}rotateWriteBuffer(){let t=this.nextWriteIndex;this.writeBuffer=this.buffers[t++],this.nextWriteIndex=t<ht?t:0}rotateReadyBuffer(){let t=this.nextReadyIndex;this.readyBuffer=this.buffers[t++],this.nextReadyIndex=t<ht?t:0}}const nt=44100,at=1/12;let ot;class lt{constructor(){this.buffer=new rt(nt),this.buffer.onbufferunderrun=t=>this.decreaseSpeed(t),this.buffer.onbufferoverrun=t=>{do{this.schedule(ot,t)}while(!this.healthy)},this.gainNode=null,this.volumeValue=1,this.next=0,this.lockedUntil=1/0,this.speedAdjustment=1}get context(){return ot||(ot=new AudioContext({sampleRate:nt}),ot.suspend()),ot}get destination(){return this.gainNode||(this.gainNode=this.context.createGain(),this.gainNode.gain.value=this.volumeValue,this.gainNode.connect(this.context.destination)),this.gainNode}get volume(){return this.volumeValue}set volume(t){this.volumeValue=Math.min(1,Math.abs(t)),this.gainNode&&(this.gainNode.gain.value=this.volumeValue)}get buffered(){return this.next-this.context.currentTime}get healthy(){return this.buffered>=at}get sampleRate(){return nt}start(){const t=this.context;this.lockedUntil=1/0,this.buffer.reset(),this.buffer.onnewbufferready=s=>{if(s.halfFull){for(s.onnewbufferready=s=>{this.healthy&&!s.halfFull||this.schedule(t,s)},t.resume(),this.next=t.currentTime;!this.healthy;)this.schedule(t,s);this.lockedUntil=this.next}}}stop(){setTimeout((()=>this.context.suspend()),1e3*this.buffered)}writeSample(t){this.buffer.writeSample(t)}schedule(t,s){const e=t.createBufferSource(),i=s.shift();e.buffer=i;let h=this.next,r=h-t.currentTime;if(r<at)e.onended=()=>{this.healthy&&!s.halfFull||this.schedule(t,s)},r<0&&(h=t.currentTime);else if(r>.25)return;e.connect(this.destination),e.start(h),this.next=h+i.duration,r>2*at&&this.increaseSpeed((1-2*at/r)/10)}increaseSpeed(t){ot.currentTime>=this.lockedUntil&&(this.speedAdjustment<1&&(this.speedAdjustment=Math.min(this.speedAdjustment*(1+t),1)),this.lockedUntil=this.next)}decreaseSpeed(t){ot.currentTime>=this.lockedUntil&&(this.speedAdjustment*=1+t,this.lockedUntil=this.next)}}class dt{constructor(){this.cpu=new R(this),this.apu=this.cpu.apu,this.ppu=new B(this),this.engine=new L(this),this.cartConnector=new Q,this.ctrlConnector=new st,this.videoOutput=new et,this.audioOutput=new lt,this.isPowered=!1}pressPower(){return this.isPowered?(this.cpu.powerOff(),this.ppu.powerOff(),this.engine.powerOff(),this.isPowered=!1):(this.cpu.powerOn(),this.ppu.powerOn(),this.engine.powerOn(),this.isPowered=!0),this.isPowered}pressReset(){this.cpu.reset(),this.ppu.reset()}pause(){return this.engine.pause()}get frontLEDState(){return this.isPowered?this.engine.isPaused?"paused":"on":"off"}insertCartridge(t){return this.cartConnector.load(t)}removeCartridge(){return this.cartConnector.unload()}insertController(t){return this.ctrlConnector.insert(t)}removeController(t){return this.ctrlConnector.remove(t)}connectVideo(t){return this.videoOutput.connect(t)}disconnectVideo(){return this.videoOutput.disconnect()}get audio(){return this.audioOutput}}t.Devices=tt,t.NES=dt,t.default=dt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=nestled.umd.min.js.map
